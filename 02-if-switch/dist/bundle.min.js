(()=>{"use strict";function t(t){return typeof t}function e(e){return null!==e&&"object"===t(e)}function n(e){return"string"===t(e)}function r(e){return"undefined"===t(e)}function s(t){return Array.isArray(t)}function o(e){return"function"===t(e)}function i(t,e){const n=t.indexOf(e);return!(n<0||(t.splice(n,1),0))}let a=!0;function c(...t){a&&console.warn(...t)}let u,l,_=0,h=1,d=!1;function f(t){u.delete(t)}function p(t){if(d)return void setTimeout(p,0,t);const e=u.get(t);if(e){d=!0;try{e()}finally{f(t),d=!1}}}const w="undefined"==typeof window?globalThis:window;if(r(w.setImmediate)){u=new Map;const t="setImmediate$"+(_++).toString(32)+"$";w.addEventListener("message",(e=>{e.source===window&&n(e.data)&&e.data.startsWith(t)&&p(Number(e.data.slice(t.length)))}),!1),l=function(e){w.postMessage(t+e,"*")}}const y=w.setImmediate||function(t){if(!o(t)||arguments.length>1)throw new Error("setImmediate require callback function.");return u.set(h,t),l(h),h++},g=w.clearImmediate||f;function m(t=""){return document.createTextNode(e(t)?JSON.stringify(t):t)}function x(t){const e=document.createDocumentFragment();return t?.forEach((t=>{e.appendChild(n(t)?document.createTextNode(t):t)})),e}function b(t,e){t.appendChild(e.length>1?x(e):n(e[0])?m(e[0]):e[0])}function N(t,n){if(n){if(!e(n))return t.removeAttribute(n);for(const e in n)N(t,e)}}function v(t,n,s){if(n)if(e(n))for(const e in n)v(t,e,n[e]);else r(s)||null===s?N(t,n):t.setAttribute(n,s)}function E(t,e,...n){return function(t,e,n){if(e)for(const n in e)n&&!r(e[n])&&v(t,n,e[n]);return n.length>0&&b(t,n),t}(document.createElement(t),e,n)}function R(t,...e){return E(t,null,...e)}function O(t,e,n,s){return function(t,e,n,s){r(s)&&(s=!!e.startsWith("touch")&&{capture:!1,passive:!0}),t.addEventListener(e,n,s)}(t,e,n,s),function(){!function(t,e,n){t.removeEventListener(e,n)}(t,e,n)}}function M(t){if(!t)return t;if(n(t))return t.trim();if(s(t)){const e=[];return t.forEach((t=>{const n=M(t);n&&e.push(n)})),e.join(" ").trim()}return Object.keys(t).filter((e=>!!t[e])).join(" ").trim()}function C(t,e){(e=M(e))?t.setAttribute("class",e):t.removeAttribute("class")}const A=new Set(["box-flex","box-flex-group","column-count","flex","flex-grow","flex-positive","flex-shrink","flex-negative","font-weight","line-clamp","line-height","opacity","order","orphans","tab-size","widows","z-index","zoom","fill-opacity","stroke-dashoffset","stroke-opacity","stroke-width"]);function I(e){if(!e)return e;if(n(e))return e.trim();if(Array.isArray(e)){const t=[];return e.forEach((e=>{const n=I(e);n&&t.push(n)})),t.join("").trim()}const r=[];return Object.keys(e).forEach((n=>{let s=e[n];(s||0===s)&&(n=n.replace(/[A-Z]/g,(t=>`-${t.toLowerCase()}`)),s=function(e){return"number"===t(e)&&!Number.isNaN(e)&&Number.isFinite(e)}(s)&&!A.has(n)?`${s}px`:s.toString(),r.push(`${n}:${s};`))})),r.join("").trim()}const S=Symbol("$$");function D(t){return n(t)?t:null===t?"null":r(t)?"undefined":t.toString()}function j(t){return n(t)?t.indexOf(".")>0?t.split("."):[t]:s(t)?t:[t]}function V(t,e,n){if(!t.__parents)return;const r=t.__parents.findIndex((t=>t.core===e&&t.prop===n));r>=0&&t.__parents.splice(r,1)}const F=new Map;function P(t){const e=F.get(t);e&&(g(e.immediate),F.delete(t))}function $(t,e,n){const r=e.__handlers;r?.forEach((e=>{n?e(t):function(t,e){if(F.has(t))return;const n=y((()=>{const e=F.get(t);try{t(e.propertyPath)}finally{F.delete(t)}}));F.set(t,{immediate:n,propertyPath:e})}(e,t)}));const s=e.__listeners;s?.forEach((e=>{$(t,e,n)}))}function T(t,e,n,r=0){const s=t.__listeners;if(!s)return;const o=D(e[r]);if(!o)return;let i=s.get(o);i&&(e.length-1===r?$(e,i,n):T(i,e,n,r+1)),i=s.get("*"),i&&(e.length-1===r?$(e,i,!0):T(i,e,n,r+1)),i=s.get("**"),i&&$(e,i,!0)}function k(t,e,n=0){const r=D(e[n]);t.__listeners||(t.__listeners=new Map);let s=t.__listeners.get(r);return s||(s={__parent:t,__property:r,__handlers:null,__listeners:null},t.__listeners.set(r,s)),e.length-1===n?s:k(s,e,n+1)}function L(t,e,n=0){const r=D(e[n]);if(!r)return null;const s=t.__listeners?.get(r);return s?e.length-1===n?s:L(s,e,n+1):null}function z(t){const e=t.__listeners;e&&(e.forEach((t=>z(t))),t.__listeners=null);const n=t.__handlers;n&&(n.forEach(P),t.__handlers=null),t.__parent=null}class B{constructor(t){this.__notifiable=!0,this.__parents=null,this.__listeners=null,this.__related=null,this.__setters=null,this.target=t,this.proxy=null,Object.defineProperty(t,S,{value:this,writable:!1,configurable:!0,enumerable:!1})}__watch(t,e,n){const r=(t=j(t)).indexOf("**");if(r>=0&&r!==t.length-1)throw new Error('wizard "**" must be last element in path.');const s=k(this,t);s.__handlers||(s.__handlers=[]),s.__handlers.indexOf(e)<0&&s.__handlers.push(e),n&&n!==this&&n.__addRelated(this,t,e)}__unwatch(t,e,n){if(!t)return void z(this);const r=L(this,j(t));if(!r)return;const s=r.__handlers;s&&(e?(P(e),i(s,e)):(s.forEach(P),s.length=0),function(t){if(t?.__handlers&&t.__handlers.length>0||t.__listeners&&t.__listeners.size>0)return null;const e=t.__parent,n=t.__property;t.__parent=null,e.__listeners.delete(n)}(r),n&&n!==this&&n.__rmRelated(this,t,e))}__notify(t,e=!1){if(!this.__notifiable)return;t=j(t),this.__listeners&&T(this,t,e);const n=this.__parents;n?.forEach((n=>{const r=n.core;r?r.__notify([n.prop].concat(t),e):console.error("dev-warn-unexpected: parent of ViewModelCore has been destroied but not unlink.")}))}__destroy(){this.__notifiable=!1,this.__parents=null,z(this),this.proxy=null,this.__related&&(this.__related.forEach(((t,e)=>{t.forEach((t=>{e.__unwatch(t.prop,t.handler)}))})),this.__related=null);const t=this.target,n=this.__setters;n&&(n.forEach(((n,r)=>{if(null===n)return;const s=t[r];e(s)&&S in s&&V(s[S],this,r)})),this.__setters=null),Object.getOwnPropertyNames(t).forEach((n=>{const r=t[n];e(r)&&S in r&&V(r[S],this,n)})),delete t[S],this.target=null}__addRelated(t,e,n){this.__related||(this.__related=new Map);let r=this.__related.get(t);r||this.__related.set(t,r=[]),r.push({prop:e,handler:n})}__rmRelated(t,e,n){if(!this.__related)return;const r=this.__related.get(t);if(!r)return;const o=s(e),i=r.findIndex((t=>n===t.handler&&(o?function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}(e,t.prop):e===t.prop)));i>=0&&r.splice(i,1)}}function q(t,s,o,i,a=!0){if(!n(c=s)||95===c.charCodeAt(0))return t[s]=o,!0;var c;const u=t[s];if(u===o&&!r(o))return!0;let l=e(o)&&!function(t){const e=t.constructor;return e===RegExp||e===Date||e===Boolean}(o);if(l&&(l=S in o,a&&!l))throw new Error(`public property "${s.toString()}" of ViewModel must also be ViewModel`);return e(u)&&S in u&&V(u[S],t[S],s),i(t,s,o),l&&(_=o[S],h=t[S],d=s,_.__parents||(_.__parents=[]),_.__parents.push({core:h,prop:d})),function(t,e){t[S].__notify(e)}(t,s),!0;var _,h,d}function W(t,e,n){t[e]=n}function J(t,e,n){const r=function(t,e){let n=t[S].__setters;if(n||(t[S].__setters=n=new Map),n.has(e))return n.get(e);{let r,s=t.constructor,i=Object.getOwnPropertyDescriptor(s.prototype,e);if(i)return r=o(i.set)?i.set:null,n.set(e,r),r;for(s=Object.getPrototypeOf(s);s?.prototype;){if(i=Object.getOwnPropertyDescriptor(s.prototype,e),i)return r=o(i.set)?i.set:null,n.set(e,r),r;s=Object.getPrototypeOf(s)}return n.set(e,null),null}}(t,e);r?r.call(t[S].proxy,n):t[e]=n}function U(t,e,n){return!(S in t)||q(t,e,n,W,!1)}function G(t,e,n){return S in t?q(t,e,n,J):(c(`call setter "${e.toString()}" after destroied, resources such as setInterval maybe not released before destroy. component:`,t),!0)}const Z=Symbol("listeners");class H{constructor(t){if(this[Z]=null,t)for(const e in t){const n=t[e];this.__on(e,n.fn,n.opts)}}async __notify(t,...e){if(!this[Z])return;const n=this[Z].get(t);if(n)for await(const[r,s]of n){try{await r(...e)}catch(e){console.error("failed __notify",t,"due to:",e)}s?.once&&n.delete(r)}}__on(t,e,n){this[Z]||(this[Z]=new Map);let r=this[Z].get(t);return r||this[Z].set(t,r=new Map),r.set(e,n),()=>{this.__off(t,e)}}__off(t,e){const n=this[Z];if(!n)return;if(!t)return n.forEach((t=>t.clear())),void n.clear();const r=n.get(t);r&&(e?r.delete(e):r.clear())}}const K=".jg-hide{display:none!important}.jg-hide.jg-hide-enter,.jg-hide.jg-hide-leave{display:block!important}";let Q=!1;!function(){if(Q)return;Q=!0;const t=E("style",{type:"text/css"});t.styleSheet?t.styleSheet.cssText=K:t.textContent=K,document.head.appendChild(t)}();const X=Symbol("__");function Y(t){return X in t}function tt(t){if(!s(t)||0===t.length)throw new Error("Render results of component is empty");return t}function et(t){if(!e(t)||s(t))throw new Error("attrs() traget must be plain object.");return function(t){const e=new B(t);return e.__notifiable=!1,e.proxy=new Proxy(t,{set:U})}(t)}class nt extends H{constructor(t){if(!e(t)||!(S in t))throw new Error("Attributes passed to Component constructor must be ViewModel. See https://[todo]");const n=t[X]||{};super(n.listeners),function(t){if(S in t)throw new Error("component has alreay been wrapped.");const e=new B(t);e.__notifiable=!1,e.proxy=new Proxy(t,{set:G})}(this),this[X]={passedAttrs:t,context:n.context||null,contextState:0,slots:n.slots,state:0,rootNodes:[],nonRootCompNodes:[],refs:null,relatedRefs:null,upNextMap:null,deregFns:null};const r=this[S].proxy;["class","style"].forEach((e=>{if(!(e in t))return;const n=()=>r[e]=t[e];n(),t[S].__watch(e,n)}))}static create(t){const n=e(t);return new this(n&&S in t?t:et(n?t:{}))[S].proxy}__addDeregisterFn(t){let e=this[X].deregFns;e||(this[X].deregFns=e=new Set),e.add(t)}__domAddListener(t,e,n,r){const s=O(t,e,(t=>{n.call(this,t)}),r);return this.__addDeregisterFn(s),()=>{s(),this[X].deregFns.delete(s)}}__domPassListeners(t,e){if(1!==this[X].state)throw new Error("domPassListeners must be applied to component which is rendered.");const n=this[Z];n&&0!==n.size&&(t&&!s(t)?(e=t,t=null):e||(e=this.__firstDOM),e.nodeType===Node.ELEMENT_NODE&&n.forEach(((n,r)=>{t&&t.indexOf(r)>=0||n.forEach(((t,n)=>{const s=O(e,r,t&&(t.stop||t.prevent)?e=>{t.stop&&e.stopPropagation(),t.prevent&&e.preventDefault(),n.call(this,e)}:t=>{n.call(this,t)},t);this.__addDeregisterFn(s)}))})))}get __transitionDOM(){const t=this[X].rootNodes[0];return Y(t)?t.__transitionDOM:t}get __firstDOM(){const t=this[X].rootNodes[0];return Y(t)?t.__firstDOM:t}get __lastDOM(){const t=this[X].rootNodes,e=t[t.length-1];return Y(e)?e.__lastDOM:e}__doRender(){const t=this.constructor;let e=t.template;if(!e&&this[X].slots&&(e=this[X].slots.default),!o(e))throw new Error(`Template of ${t.name} not found. Forget static getter "template"?`);return e(this)}async __render(){return await this.__beforeRender(),await this.__notify("before-render"),tt(await this.__doRender())}async __renderToDOM(t,e=!0){if(0!==this[X].state)throw new Error("component has already been rendered.");const n=tt(await this.__render());var r,s;e?(r=n,s=t,t.parentNode.replaceChild(x(r),s)):b(t,n),await this.__handleAfterRender()}async __destroy(t=!0){const e=this[X];if(!(e.state>2)){if(e.state=2,this[S].__notifiable=!1,e.passedAttrs[S].__notifiable=!1,await this.__notify("before-destroy"),await this.__beforeDestroy(),await this.__handleBeforeDestroy(t),super.__off(),e.passedAttrs[S].__destroy(),e.passedAttrs=null,this[S].__destroy(),e.upNextMap&&(e.upNextMap.forEach((t=>{g(t)})),e.upNextMap=null),e.relatedRefs&&(e.relatedRefs.forEach((t=>{const e=t.origin[X].refs;if(!e)return;const n=e.get(t.ref);s(n)?i(n,t.node||this):e.delete(t.ref)})),e.relatedRefs=null),e.deregFns){for await(const t of Array.from(e.deregFns))await t();e.deregFns.clear(),e.deregFns=null}e.state=3,e.rootNodes=e.nonRootCompNodes=e.refs=e.slots=e.context=null}}async __handleBeforeDestroy(t=!1){for await(const t of this[X].nonRootCompNodes)await t.__destroy(!1);let e;for await(const n of this[X].rootNodes)Y(n)?await n.__destroy(t):t&&(e||(e=n.parentNode),e.removeChild(n))}async __handleAfterRender(){this[X].passedAttrs[S].__notifiable=!0,this[S].__notifiable=!0;for await(const t of this[X].rootNodes)Y(t)&&await t.__handleAfterRender();for await(const t of this[X].nonRootCompNodes)await t.__handleAfterRender();this[X].state=1,this[X].contextState=1===this[X].contextState?3:2,await this.__afterRender(),await this.__notify("after-render")}__updateIfNeed(t,e=!0){if(1!==this[X].state)return;if(!1===t)return void this.__update();if(o(t)||(t=this.__update),!e)return void t.call(this);let n=this[X].upNextMap;n||(n=this[X].upNextMap=new Map),n.has(t)||n.set(t,y((()=>{n.delete(t),t.call(this)})))}__update(t){}__setContext(t,e,n=!1){if(2===this[X].contextState||3===this[X].contextState)throw new Error("Can't setContext after component has been rendered. Try put setContext code into constructor.");if(0===this[X].contextState&&(this[X].context=Object.assign({},this[X].context),this[X].contextState=1),t in this[X].context&&!n)throw new Error(`Contenxt with key: ${t.toString()} is exist. Pass third argument forceOverride=true to override it.`);this[X].context[t]=e}__getContext(t){return this[X].context?.[t]}__setRef(t,e,n){let r=this[X].refs;r||(this[X].refs=r=new Map);let o=r.get(t);o?s(o)?o.push(e):(o=[o,e],r.set(t,o)):r.set(t,e);const i=Y(e);if(!i&&this===n)return;let a=(i?e:n)[X].relatedRefs;a||((i?e:n)[X].relatedRefs=a=[]),a.push({origin:this,ref:t,node:i?null:e})}__getRef(t){return 1!==this[X].state&&c(`Warning: call __getRef before component '${this.constructor.name}' rendered will get nothing. see https://[TODO]`),this[X].refs?.get(t)}__beforeRender(){}__afterRender(){}__beforeDestroy(){}}function rt(t,e){const n=et({[X]:{context:e,slots:{default:t}}});return nt.create(n)}function st(t){const e=t._currentValue,n=t[X].slots,r=n?n[e]:null,s=t[X].rootNodes;if(!r)return s.push(document.createComment("empty")),s;const o=rt(r,t[X].context);return s.push(o),o.__render()}async function ot(t){const e=t[X].rootNodes,n=e[0],r=Y(n),s=r?n.__firstDOM:n,o=(r?s:n).parentNode,i=t[X].slots?.[t._currentValue];if(i){const n=rt(i,t[X].context),r=await n.__render();o.insertBefore(r.length>1?x(r):r[0],s),e[0]=n}else e[0]=document.createComment("empty"),o.insertBefore(e[0],s);r?await n.__destroy():o.removeChild(s),i&&await e[0].__handleAfterRender(),await t.__notify("branch-switched",t._branch)}nt[X]=!0;class it extends nt{constructor(t){super(t);const e=this[S].proxy;e._currentValue="default",e._previousValue=null;const n=()=>{e.expect=t.expect};n(),t[S].__watch("expect",n)}get expect(){return"default"===this._currentValue}set expect(t){const e=t?"default":"else";this._currentValue!==e&&(this._currentValue=e,this.__updateIfNeed())}get _branch(){return this.expect}__doRender(){return st(this)}__update(){if(Y(this[X].rootNodes[0])||this[X].slots?.[this._currentValue])return ot(this)}}class at extends nt{constructor(t){super(t);const e=this[S].proxy;e._previousValue=null,e._currentValue=null;const n=()=>{e.test=t.test};n(),t[S].__watch("test",n)}get test(){return this._currentValue}set test(t){const e=this[X].slots;e&&t in e||(t="default"),this._currentValue!==t&&(this._currentValue=t,this.__updateIfNeed())}get _branch(){return this.test}__doRender(){return st(this)}__update(){if(Y(this[X].rootNodes[0])||this[X].slots?.[this._currentValue])return ot(this)}}function ct(t,e){const n=m(e);return t[X].rootNodes.push(n),n}async function ut(t){const n=t;return[(()=>{const e=R("h2","Simple If");return t[X].rootNodes.push(e),e})(),await(async()=>{const e=R("div",R("p",...await(()=>{const e=et({[X]:{context:t[X].context,slots:{default:async function(t){return[ct(t,"It's greater than 5.")]}}},expect:void 0}),r=()=>{e.expect=n.n>5};r(),n[S].__watch(["n"],r,t[S]);const s=it.create(e);return t[X].nonRootCompNodes.push(s),s.__render()})(),...await(()=>{const e=et({[X]:{context:t[X].context,slots:{default:async function(t){return[ct(t,"It's less or equal than 5.")]}}},expect:void 0}),r=()=>{e.expect=n.n<=5};r(),n[S].__watch(["n"],r,t[S]);const s=it.create(e);return t[X].nonRootCompNodes.push(s),s.__render()})()));return t[X].rootNodes.push(e),e})(),(()=>{const e=R("h2","Multiple Elements Under If");return t[X].rootNodes.push(e),e})(),await(async()=>{const e=R("div",R("p",...await(()=>{const e=et({[X]:{context:t[X].context,slots:{default:async function(t){return[ct(t,"It's"),(()=>{const e=R("span","greater than"),r=()=>{var t,r;t=e,(r=I(r="color: "+(n.n>=8?"red":"blue")))?t.setAttribute("style",r):t.removeAttribute("style")};return r(),n[S].__watch(["n"],r,t[S]),t[X].rootNodes.push(e),e})(),(()=>{const e=R("span","5.");return t[X].rootNodes.push(e),e})()]}}},expect:void 0}),r=()=>{e.expect=n.n>5};r(),n[S].__watch(["n"],r,t[S]);const s=it.create(e);return t[X].nonRootCompNodes.push(s),s.__render()})()));return t[X].rootNodes.push(e),e})(),(()=>{const e=R("h2","If and Else");return t[X].rootNodes.push(e),e})(),await(async()=>{const e=R("div",R("p",...await(()=>{const e=et({[X]:{context:t[X].context,slots:{default:async function(t){return[ct(t,"It's greater than"),(()=>{const e=R("span","5");return t[X].rootNodes.push(e),e})()]},else:async function(t){return[ct(t,"It's less or equal than"),(()=>{const e=R("span","5");return t[X].rootNodes.push(e),e})()]}}},expect:void 0}),r=()=>{e.expect=n.n>5};r(),n[S].__watch(["n"],r,t[S]);const s=it.create(e);return t[X].nonRootCompNodes.push(s),s.__render()})()),R("p",...await(()=>{const e=et({[X]:{context:t[X].context,listeners:{"branch-switched":{fn:function(...t){n.log("if updated",...t)},opts:null}},slots:{default:async function(t){return[(()=>{const e=R("span","It's greater than 5.");return t[X].rootNodes.push(e),e})()]},else:async function(t){return[(()=>{const e=R("span","It's less or equal than 5.");return t[X].rootNodes.push(e),e})()]}}},expect:void 0}),r=()=>{e.expect=n.n>5};r(),n[S].__watch(["n"],r,t[S]);const s=it.create(e);return t[X].nonRootCompNodes.push(s),s.__render()})()));return t[X].rootNodes.push(e),e})(),(()=>{const e=R("h2","Use class-name instead of If");return t[X].rootNodes.push(e),e})(),(()=>{const e=R("div",R("p",(()=>{const e=R("span","It's greater than 5."),r=()=>{C(e,n.n<=5?"hide":"")};return r(),n[S].__watch(["n"],r,t[S]),e})(),(()=>{const e=R("span","It's less or equal than 5."),r=()=>{C(e,n.n>5?"hide":"")};return r(),n[S].__watch(["n"],r,t[S]),e})()));return t[X].rootNodes.push(e),e})(),(()=>{const e=R("h2","Switch-Case");return t[X].rootNodes.push(e),e})(),await(async()=>{const r=R("div",R("p",...await(()=>{const r=et({[X]:{context:t[X].context,listeners:{"branch-switched":{fn:function(...t){n.log("switch updated",...t)},opts:null}},slots:{0:async function(t){return[ct(t,"零")]},3:async function(t){return[ct(t,"三")]},8:async function(t){return[(()=>{const e=R("p","八");return t[X].rootNodes.push(e),e})()]},default:async function(t){return[(()=>{const r=m(),s=()=>{var t,s;t=r,e(s=n.n)&&(s=JSON.stringify(s)),t.textContent=s};return s(),n[S].__watch(["n"],s,t[S]),t[X].rootNodes.push(r),r})(),...await(()=>{const e=et({[X]:{context:t[X].context,slots:{default:async function(t){return[ct(t,"> 5")]}}},expect:void 0}),r=()=>{e.expect=n.n>5};r(),n[S].__watch(["n"],r,t[S]);const s=it.create(e);return t[X].rootNodes.push(s),s.__render()})()]}}},test:void 0}),s=()=>{r.test=n.n};s(),n[S].__watch(["n"],s,t[S]);const o=at.create(r);return t[X].nonRootCompNodes.push(o),o.__render()})()));return t[X].rootNodes.push(r),r})()]}!async function(t,e,n){const r=t.create(void 0);await r.__renderToDOM(e,e!==document.body)}(class extends nt{static get template(){return ut}constructor(t){super(t);const e=this[S].proxy;e.n=10*Math.random()|0,setInterval((()=>{e.n=10*Math.random()|0,console.log(e.n)}),1e3)}log(...t){console.log("ARGS:",t.length,...t)}},document.getElementById("root-app"))})();
//# sourceMappingURL=bundle.min.js.map