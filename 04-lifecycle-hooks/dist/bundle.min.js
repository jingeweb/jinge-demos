(()=>{"use strict";function t(t){return typeof t}function e(e){return null!==e&&"object"===t(e)}function n(e){return"string"===t(e)}function o(e){return"undefined"===t(e)}function r(t){return Array.isArray(t)}function s(e){return"function"===t(e)}function i(t,e){const n=t.indexOf(e);return!(n<0||(t.splice(n,1),0))}let a=!0;function c(...t){a&&console.warn(...t)}let l,_,u=0,h=1,d=!1;function f(t){l.delete(t)}function p(t){if(d)return void setTimeout(p,0,t);const e=l.get(t);if(e){d=!0;try{e()}finally{f(t),d=!1}}}const w="undefined"==typeof window?globalThis:window;if(o(w.setImmediate)){l=new Map;const t="setImmediate$"+(u++).toString(32)+"$";w.addEventListener("message",(e=>{e.source===window&&n(e.data)&&e.data.startsWith(t)&&p(Number(e.data.slice(t.length)))}),!1),_=function(e){w.postMessage(t+e,"*")}}const y=w.setImmediate||function(t){if(!s(t)||arguments.length>1)throw new Error("setImmediate require callback function.");return l.set(h,t),_(h),h++},g=w.clearImmediate||f;function m(t,n){e(n)&&(n=JSON.stringify(n)),t.textContent=n}function x(t=""){return document.createTextNode(e(t)?JSON.stringify(t):t)}function b(t){const e=document.createDocumentFragment();return t?.forEach((t=>{e.appendChild(n(t)?document.createTextNode(t):t)})),e}function N(t,e){t.appendChild(e.length>1?b(e):n(e[0])?x(e[0]):e[0])}function E(t,n){if(n){if(!e(n))return t.removeAttribute(n);for(const e in n)E(t,e)}}function R(t,n,r){if(n)if(e(n))for(const e in n)R(t,e,n[e]);else o(r)||null===r?E(t,n):t.setAttribute(n,r)}function v(t,e,...n){return function(t,e,n){if(e)for(const n in e)n&&!o(e[n])&&R(t,n,e[n]);return n.length>0&&N(t,n),t}(document.createElement(t),e,n)}function M(t,...e){return v(t,null,...e)}function O(t,e,n,r){o(r)&&(r=!!e.startsWith("touch")&&{capture:!1,passive:!0}),t.addEventListener(e,n,r)}function C(t,e,n,o){return O(t,e,n,o),function(){!function(t,e,n){t.removeEventListener(e,n)}(t,e,n)}}const A=Symbol("$$");function D(t){return n(t)?t:null===t?"null":o(t)?"undefined":t.toString()}function S(t){return n(t)?t.indexOf(".")>0?t.split("."):[t]:r(t)?t:[t]}function B(t,e,n){if(!t.__parents)return;const o=t.__parents.findIndex((t=>t.core===e&&t.prop===n));o>=0&&t.__parents.splice(o,1)}const I=new Map;function P(t){const e=I.get(t);e&&(g(e.immediate),I.delete(t))}function j(t,e,n){const o=e.__handlers;o?.forEach((e=>{n?e(t):function(t,e){if(I.has(t))return;const n=y((()=>{const e=I.get(t);try{t(e.propertyPath)}finally{I.delete(t)}}));I.set(t,{immediate:n,propertyPath:e})}(e,t)}));const r=e.__listeners;r?.forEach((e=>{j(t,e,n)}))}function F(t,e,n,o=0){const r=t.__listeners;if(!r)return;const s=D(e[o]);if(!s)return;let i=r.get(s);i&&(e.length-1===o?j(e,i,n):F(i,e,n,o+1)),i=r.get("*"),i&&(e.length-1===o?j(e,i,!0):F(i,e,n,o+1)),i=r.get("**"),i&&j(e,i,!0)}function T(t,e,n=0){const o=D(e[n]);t.__listeners||(t.__listeners=new Map);let r=t.__listeners.get(o);return r||(r={__parent:t,__property:o,__handlers:null,__listeners:null},t.__listeners.set(o,r)),e.length-1===n?r:T(r,e,n+1)}function $(t,e,n=0){const o=D(e[n]);if(!o)return null;const r=t.__listeners?.get(o);return r?e.length-1===n?r:$(r,e,n+1):null}function L(t){const e=t.__listeners;e&&(e.forEach((t=>L(t))),t.__listeners=null);const n=t.__handlers;n&&(n.forEach(P),t.__handlers=null),t.__parent=null}class k{constructor(t){this.__notifiable=!0,this.__parents=null,this.__listeners=null,this.__related=null,this.__setters=null,this.target=t,this.proxy=null,Object.defineProperty(t,A,{value:this,writable:!1,configurable:!0,enumerable:!1})}__watch(t,e,n){const o=(t=S(t)).indexOf("**");if(o>=0&&o!==t.length-1)throw new Error('wizard "**" must be last element in path.');const r=T(this,t);r.__handlers||(r.__handlers=[]),r.__handlers.indexOf(e)<0&&r.__handlers.push(e),n&&n!==this&&n.__addRelated(this,t,e)}__unwatch(t,e,n){if(!t)return void L(this);const o=$(this,S(t));if(!o)return;const r=o.__handlers;r&&(e?(P(e),i(r,e)):(r.forEach(P),r.length=0),function(t){if(t?.__handlers&&t.__handlers.length>0||t.__listeners&&t.__listeners.size>0)return null;const e=t.__parent,n=t.__property;t.__parent=null,e.__listeners.delete(n)}(o),n&&n!==this&&n.__rmRelated(this,t,e))}__notify(t,e=!1){if(!this.__notifiable)return;t=S(t),this.__listeners&&F(this,t,e);const n=this.__parents;n?.forEach((n=>{const o=n.core;o?o.__notify([n.prop].concat(t),e):console.error("dev-warn-unexpected: parent of ViewModelCore has been destroied but not unlink.")}))}__destroy(){this.__notifiable=!1,this.__parents=null,L(this),this.proxy=null,this.__related&&(this.__related.forEach(((t,e)=>{t.forEach((t=>{e.__unwatch(t.prop,t.handler)}))})),this.__related=null);const t=this.target,n=this.__setters;n&&(n.forEach(((n,o)=>{if(null===n)return;const r=t[o];e(r)&&A in r&&B(r[A],this,o)})),this.__setters=null),Object.getOwnPropertyNames(t).forEach((n=>{const o=t[n];e(o)&&A in o&&B(o[A],this,n)})),delete t[A],this.target=null}__addRelated(t,e,n){this.__related||(this.__related=new Map);let o=this.__related.get(t);o||this.__related.set(t,o=[]),o.push({prop:e,handler:n})}__rmRelated(t,e,n){if(!this.__related)return;const o=this.__related.get(t);if(!o)return;const s=r(e),i=o.findIndex((t=>n===t.handler&&(s?function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}(e,t.prop):e===t.prop)));i>=0&&o.splice(i,1)}}function V(t,r,s,i,a=!0){if(!n(c=r)||95===c.charCodeAt(0))return t[r]=s,!0;var c;const l=t[r];if(l===s&&!o(s))return!0;let _=e(s)&&!function(t){const e=t.constructor;return e===RegExp||e===Date||e===Boolean}(s);if(_&&(_=A in s,a&&!_))throw new Error(`public property "${r.toString()}" of ViewModel must also be ViewModel`);return e(l)&&A in l&&B(l[A],t[A],r),i(t,r,s),_&&(u=s[A],h=t[A],d=r,u.__parents||(u.__parents=[]),u.__parents.push({core:h,prop:d})),function(t,e){t[A].__notify(e)}(t,r),!0;var u,h,d}function z(t,e,n){t[e]=n}function H(t,e,n){const o=function(t,e){let n=t[A].__setters;if(n||(t[A].__setters=n=new Map),n.has(e))return n.get(e);{let o,r=t.constructor,i=Object.getOwnPropertyDescriptor(r.prototype,e);if(i)return o=s(i.set)?i.set:null,n.set(e,o),o;for(r=Object.getPrototypeOf(r);r?.prototype;){if(i=Object.getOwnPropertyDescriptor(r.prototype,e),i)return o=s(i.set)?i.set:null,n.set(e,o),o;r=Object.getPrototypeOf(r)}return n.set(e,null),null}}(t,e);o?o.call(t[A].proxy,n):t[e]=n}function J(t,e,n){return!(A in t)||V(t,e,n,z,!1)}function W(t,e,n){return A in t?V(t,e,n,H):(c(`call setter "${e.toString()}" after destroied, resources such as setInterval maybe not released before destroy. component:`,t),!0)}const q=Symbol("listeners");class G{constructor(t){if(this[q]=null,t)for(const e in t){const n=t[e];this.__on(e,n.fn,n.opts)}}async __notify(t,...e){if(!this[q])return;const n=this[q].get(t);if(n)for await(const[o,r]of n){try{await o(...e)}catch(e){console.error("failed __notify",t,"due to:",e)}r?.once&&n.delete(o)}}__on(t,e,n){this[q]||(this[q]=new Map);let o=this[q].get(t);return o||this[q].set(t,o=new Map),o.set(e,n),()=>{this.__off(t,e)}}__off(t,e){const n=this[q];if(!n)return;if(!t)return n.forEach((t=>t.clear())),void n.clear();const o=n.get(t);o&&(e?o.delete(e):o.clear())}}const K=".jg-hide{display:none!important}.jg-hide.jg-hide-enter,.jg-hide.jg-hide-leave{display:block!important}";let Q=!1;!function(){if(Q)return;Q=!0;const t=v("style",{type:"text/css"});t.styleSheet?t.styleSheet.cssText=K:t.textContent=K,document.head.appendChild(t)}();const U=Symbol("__");function X(t){return U in t}function Y(t){if(!r(t)||0===t.length)throw new Error("Render results of component is empty");return t}function Z(t){if(!e(t)||r(t))throw new Error("attrs() traget must be plain object.");return function(t){const e=new k(t);return e.__notifiable=!1,e.proxy=new Proxy(t,{set:J})}(t)}class tt extends G{constructor(t){if(!e(t)||!(A in t))throw new Error("Attributes passed to Component constructor must be ViewModel. See https://[todo]");const n=t[U]||{};super(n.listeners),function(t){if(A in t)throw new Error("component has alreay been wrapped.");const e=new k(t);e.__notifiable=!1,e.proxy=new Proxy(t,{set:W})}(this),this[U]={passedAttrs:t,context:n.context||null,contextState:0,slots:n.slots,state:0,rootNodes:[],nonRootCompNodes:[],refs:null,relatedRefs:null,upNextMap:null,deregFns:null};const o=this[A].proxy;["class","style"].forEach((e=>{if(!(e in t))return;const n=()=>o[e]=t[e];n(),t[A].__watch(e,n)}))}static create(t){const n=e(t);return new this(n&&A in t?t:Z(n?t:{}))[A].proxy}__addDeregisterFn(t){let e=this[U].deregFns;e||(this[U].deregFns=e=new Set),e.add(t)}__domAddListener(t,e,n,o){const r=C(t,e,(t=>{n.call(this,t)}),o);return this.__addDeregisterFn(r),()=>{r(),this[U].deregFns.delete(r)}}__domPassListeners(t,e){if(1!==this[U].state)throw new Error("domPassListeners must be applied to component which is rendered.");const n=this[q];n&&0!==n.size&&(t&&!r(t)?(e=t,t=null):e||(e=this.__firstDOM),e.nodeType===Node.ELEMENT_NODE&&n.forEach(((n,o)=>{t&&t.indexOf(o)>=0||n.forEach(((t,n)=>{const r=C(e,o,t&&(t.stop||t.prevent)?e=>{t.stop&&e.stopPropagation(),t.prevent&&e.preventDefault(),n.call(this,e)}:t=>{n.call(this,t)},t);this.__addDeregisterFn(r)}))})))}get __transitionDOM(){const t=this[U].rootNodes[0];return X(t)?t.__transitionDOM:t}get __firstDOM(){const t=this[U].rootNodes[0];return X(t)?t.__firstDOM:t}get __lastDOM(){const t=this[U].rootNodes,e=t[t.length-1];return X(e)?e.__lastDOM:e}__doRender(){const t=this.constructor;let e=t.template;if(!e&&this[U].slots&&(e=this[U].slots.default),!s(e))throw new Error(`Template of ${t.name} not found. Forget static getter "template"?`);return e(this)}async __render(){return await this.__beforeRender(),await this.__notify("before-render"),Y(await this.__doRender())}async __renderToDOM(t,e=!0){if(0!==this[U].state)throw new Error("component has already been rendered.");const n=Y(await this.__render());var o,r;e?(o=n,r=t,t.parentNode.replaceChild(b(o),r)):N(t,n),await this.__handleAfterRender()}async __destroy(t=!0){const e=this[U];if(!(e.state>2)){if(e.state=2,this[A].__notifiable=!1,e.passedAttrs[A].__notifiable=!1,await this.__notify("before-destroy"),await this.__beforeDestroy(),await this.__handleBeforeDestroy(t),super.__off(),e.passedAttrs[A].__destroy(),e.passedAttrs=null,this[A].__destroy(),e.upNextMap&&(e.upNextMap.forEach((t=>{g(t)})),e.upNextMap=null),e.relatedRefs&&(e.relatedRefs.forEach((t=>{const e=t.origin[U].refs;if(!e)return;const n=e.get(t.ref);r(n)?i(n,t.node||this):e.delete(t.ref)})),e.relatedRefs=null),e.deregFns){for await(const t of Array.from(e.deregFns))await t();e.deregFns.clear(),e.deregFns=null}e.state=3,e.rootNodes=e.nonRootCompNodes=e.refs=e.slots=e.context=null}}async __handleBeforeDestroy(t=!1){for await(const t of this[U].nonRootCompNodes)await t.__destroy(!1);let e;for await(const n of this[U].rootNodes)X(n)?await n.__destroy(t):t&&(e||(e=n.parentNode),e.removeChild(n))}async __handleAfterRender(){this[U].passedAttrs[A].__notifiable=!0,this[A].__notifiable=!0;for await(const t of this[U].rootNodes)X(t)&&await t.__handleAfterRender();for await(const t of this[U].nonRootCompNodes)await t.__handleAfterRender();this[U].state=1,this[U].contextState=1===this[U].contextState?3:2,await this.__afterRender(),await this.__notify("after-render")}__updateIfNeed(t,e=!0){if(1!==this[U].state)return;if(!1===t)return void this.__update();if(s(t)){if(!e)return void t.call(this)}else{if(!e)return void this.__update();t=this.__update}let n=this[U].upNextMap;n||(n=this[U].upNextMap=new Map),n.has(t)||n.set(t,y((()=>{n.delete(t),t.call(this)})))}__update(t){}__setContext(t,e,n=!1){if(2===this[U].contextState||3===this[U].contextState)throw new Error("Can't setContext after component has been rendered. Try put setContext code into constructor.");if(0===this[U].contextState&&(this[U].context=Object.assign({},this[U].context),this[U].contextState=1),t in this[U].context&&!n)throw new Error(`Contenxt with key: ${t.toString()} is exist. Pass third argument forceOverride=true to override it.`);this[U].context[t]=e}__getContext(t){return this[U].context?.[t]}__setRef(t,e,n){let o=this[U].refs;o||(this[U].refs=o=new Map);let s=o.get(t);s?r(s)?s.push(e):(s=[s,e],o.set(t,s)):o.set(t,e);const i=X(e);if(!i&&this===n)return;let a=(i?e:n)[U].relatedRefs;a||((i?e:n)[U].relatedRefs=a=[]),a.push({origin:this,ref:t,node:i?null:e})}__getRef(t){return 1!==this[U].state&&c(`Warning: call __getRef before component '${this.constructor.name}' rendered will get nothing. see https://[TODO]`),this[U].refs?.get(t)}__beforeRender(){}__afterRender(){}__beforeDestroy(){}}function et(t,e){const n=Z({[U]:{context:e,slots:{default:t}}});return tt.create(n)}function nt(t,e){const n=t[U].slots;return n?e?"true"in n?"true":"default":"false"in n?"false":"else":"default"}tt[U]=!0;class ot extends tt{constructor(t){super(t);const e=this[A].proxy,n=()=>{e.expect=t.expect};n(),t[A].__watch("expect",n)}get expect(){return this._e}set expect(t){this._e!==t&&(this._e=t,this.__updateIfNeed())}async __doRender(){const t=this._e;this._u=nt(this,this._e);const e=await function(t,e){const n=t[U].slots,o=n?n[e]:null,r=t[U].rootNodes;if(!o)return r.push(document.createComment("empty")),r;const s=et(o,t[U].context);return r.push(s),s.__render()}(this,this._u);return this._u=void 0,await this.__notify("branch-switched",t),t!==this._e&&this.__updateIfNeed(),e}async __update(){if(this._u)return;const t=this._e;this._u=nt(this,t),X(this[U].rootNodes[0])||this[U].slots?.[this._u]?(await async function(t,e){const n=t[U].rootNodes,o=n[0],r=X(o),s=r?o.__firstDOM:o,i=(r?s:o).parentNode,a=t[U].slots?.[e];if(a){const e=et(a,t[U].context),o=await e.__render();i.insertBefore(o.length>1?b(o):o[0],s),n[0]=e}else n[0]=document.createComment("empty"),i.insertBefore(n[0],s);r?await o.__destroy():i.removeChild(s),a&&await n[0].__handleAfterRender()}(this,this._u),this._u=void 0,await this.__notify("branch-switched",t),t!==this._e&&this.__updateIfNeed()):this._u=void 0}}async function rt(t){const e=t;return[(()=>{const n=M("span",(()=>{const n=x(),o=()=>{m(n,`Hello, Everyone!\n          My name is ${e.name}!`)};return o(),e[A].__watch(["name"],o,t[A]),n})());return e.__setRef("someId",n,t),t[U].rootNodes.push(n),n})()]}class st extends tt{static get template(){return rt}constructor(t){super(t);const e=this[A].proxy,n=()=>{e.name=t.name};n(),t[A].__watch("name",n)}someApi(){alert(`Hello, everyone. My name is ${this.name}`),this.__notify("someApiCalled",this.name)}async __beforeRender(){console.log("before render start"),await new Promise((t=>setTimeout(t,3e3))),console.log("before render end")}__afterRender(){console.log("after render"),console.log(this.__getRef("someId"))}__beforeDestroy(){console.log("before destroy")}}async function it(t){const e=t;return[(()=>{const e=M("h2","Lifecycle demo");return t[U].rootNodes.push(e),e})(),(()=>{const e=M("p","Each component have two lifecycle hooks,\n        afterRender and beforeDestroy.");return t[U].rootNodes.push(e),e})(),await(async()=>{const n=M("p",...await(()=>{const n=Z({[U]:{context:t[U].context,slots:{default:async function(t){return[...await(()=>{const n=Z({[U]:{context:t[U].context,listeners:{someApiCalled:{fn:function(...t){e.onBoyApiCalled(...t)},opts:null}}},name:void 0}),o=()=>{n.name=`${e.name}_${e.inc}`};o(),e[A].__watch(["name"],o,t[A]),e[A].__watch(["inc"],o,t[A]);const r=st.create(n);return e.__setRef("boy",r,t),t[U].rootNodes.push(r),r.__render()})()]}}},expect:void 0}),o=()=>{n.expect=e.showBoy};o(),e[A].__watch(["showBoy"],o,t[A]);const r=ot.create(n);return t[U].nonRootCompNodes.push(r),r.__render()})());return t[U].rootNodes.push(n),n})(),await(async()=>{const n=M("p",(()=>{const n=M("button",(()=>{const n=x(),o=()=>{m(n,(e.showBoy?"Hide":"Show")+" Boy")};return o(),e[A].__watch(["showBoy"],o,t[A]),n})());return O(n,"click",(function(...t){e.toggleShow(...t)})),n})(),...await(()=>{const n=Z({[U]:{context:t[U].context,slots:{default:async function(t){return[(()=>{const n=M("button","Call Api");return O(n,"click",(function(...t){e.callApi(...t)})),t[U].rootNodes.push(n),n})()]}}},expect:void 0}),o=()=>{n.expect=e.showBoy};o(),e[A].__watch(["showBoy"],o,t[A]);const r=ot.create(n);return t[U].nonRootCompNodes.push(r),r.__render()})());return t[U].rootNodes.push(n),n})()]}!async function(t,e,n){const o=t.create(void 0);await o.__renderToDOM(e,e!==document.body)}(class extends tt{static get template(){return it}constructor(t){super(t);const e=this[A].proxy;e.showBoy=!0,e.inc=0,e.name="Jinge"}__afterRender(){this.callApi()}log(...t){console.log(...t)}callApi(t){console.log(t),this.__getRef("boy").someApi()}onBoyApiCalled(t){console.log("boy",t,"send message: someApiCalled")}toggleShow(t){this.showBoy=!this.showBoy,this.inc++,console.log(t,this.inc)}},document.getElementById("root-app"))})();
//# sourceMappingURL=bundle.min.js.map